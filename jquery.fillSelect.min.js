/*!
 *  Fill Select
 *
 *  @version 1.0.5
 *  @author Mitchell Petty <https://github.com/mpetty/fill-select>
 * 	@todo Ajax functionality needs to be cleaned up.
 */
!function(a){"use strict";var b=function(b,c){this.selector=a(b),this.options=a.extend({},a.fn.fillSelect.defaults,c),this.fillSelectGlobal=a.fillSelect,this.selector.data("fillSelect",this.options),this.method=!1,this.create()};fillSelect.prototype={create:function(){var b=this;"undefined"!=typeof this.fillSelectGlobal.ajaxMethods[this.options.method]?(this.method=this.fillSelectGlobal.ajaxMethods[this.options.method],this.method.results?(this.setHTML(),this.fillSelectGlobal.trigger("fillfield_renderComplete.fillfield")):a(this.fillSelectGlobal).on("ajaxComplete.fillSelect-"+this.method.id,function(){b.method=b.fillSelectGlobal.ajaxMethods[b.options.method],b.setHTML(),a(this.fillSelectGlobal).off("ajaxComplete.fillSelect-"+b.method.id),b.method.active&&b.fillSelectGlobal.trigger("renderComplete")})):"undefined"!=typeof this.fillSelectGlobal.methods[this.options.method]&&(this.method=this.fillSelectGlobal.methods[this.options.method],this.setHTML())},getResults:function(){var a=this.method.results||!1,b=[];if("undefined"!=typeof a&&a)for(var c in a)b.push({value:c,name:a[c]});return b},setHTML:function(){var b=[],c=this.selector.val(),d=this.getResults();if(d){a.isArray(c)||(c=[c]),this.options.defaultText&&b.push(this.setOptionString("",this.options.defaultText,this.options.optionString));for(var e in d)b.push(-1!==a.inArray(d[e].value,c)?this.setOptionString(d[e].value,d[e].name,this.options.optionString,{selected:"selected"}):this.setOptionString(d[e].value,d[e].name,this.options.optionString));b=a(b.join("")),b.length&&this.selector.empty().append(b),"function"==typeof this.options.callback&&this.options.callback.call(this,this.selector)}},setOptionString:function(a,b,c,d){var e="",f="";if("function"==typeof c?c=c(a,b):"string"!=typeof c&&(c="option"),"undefined"!=typeof d)for(var g in d)f+=" "+g+'="'+d[g]+'"';return e+="<",e+=c,e+=f,e+=' value="'+a+'">',e+=b,e+="</option>"}},a.fillSelect={addMethod:function(b,c,d,e){var f=this,g="undefined"!=typeof e?e:!0,h={global:!1};"function"==typeof c?this.methods[b]={name:b,method:c,results:c()}:"object"==typeof c&&(g&&this.ajaxEvCount++,this.ajaxMethods[b]={active:g,name:b,id:this.ajaxEvCount,method:d,ajaxComplete:!1,results:null,args:null},h.success=function(c){g&&f.ajaxEvComplete++,f.ajaxMethods[b].args=c,f.ajaxMethods[b].ajaxComplete=!0,f.ajaxMethods[b].results=d(c),a.fillSelect.trigger("ajaxSuccess")},h.error=function(){a.fillSelect.trigger("ajaxError")},h.complete=function(){a.fillSelect.trigger("ajaxComplete.fillSelect-"+f.ajaxMethods[b].id)},this.ajaxDeferred.push(a.ajax(a.extend({},h,c))))},trigger:function(b){"string"==typeof b&&a(this).trigger(b)},methods:{},ajaxMethods:{},ajaxDeferred:[],ajaxEvCount:0,ajaxEvComplete:0},a.fn.fillSelect=function(c){return this.each(function(){a(this).data("fillSelect")||c,new b(this,c);return this})},a.fn.fillSelect.defaults={method:!1,callback:a.noop,defaultText:"Select One",optionString:"option"}}(jQuery);